# Gemini KEYç»„ç®¡ç† - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. è¿è¡Œæ•°æ®åº“è¿ç§»

é¦–å…ˆéœ€è¦åˆ›å»º Gemini KEY ç»„çš„æ•°æ®åº“è¡¨ï¼š

```bash
# è¿æ¥åˆ° MySQL æ•°æ®åº“
mysql -u your_username -p your_database

# æ‰§è¡Œ migration æ–‡ä»¶
source backend/src/database/migrations/16-create-gemini-key-groups-table.sql

# æˆ–è€…ç›´æ¥æ‰§è¡Œ
mysql -u your_username -p your_database < backend/src/database/migrations/16-create-gemini-key-groups-table.sql
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
./start-local.sh
```

æœåŠ¡å¯åŠ¨åï¼š
- **åç«¯ API**: http://localhost:3000
- **ç®¡ç†åå°**: http://localhost:5173

### 3. è®¿é—®ç®¡ç†ç•Œé¢

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173
2. ç™»å½•ç®¡ç†åå°
3. è¿›å…¥ **è®¾ç½® â†’ AIé…ç½®ç®¡ç†** é¡µé¢
4. å‘ä¸‹æ»šåŠ¨åˆ° **"Geminiå¯†é’¥ç»„ç®¡ç†"** éƒ¨åˆ†

## ğŸ“ åˆ›å»ºç¬¬ä¸€ä¸ª KEY ç»„

### æ­¥éª¤ 1ï¼šç‚¹å‡»"åˆ›å»ºKEYç»„"

åœ¨ Gemini å¯†é’¥ç»„ç®¡ç†åŒºåŸŸï¼Œç‚¹å‡»å³ä¸Šè§’çš„ **"åˆ›å»ºKEYç»„"** æŒ‰é’®ã€‚

### æ­¥éª¤ 2ï¼šå¡«å†™åŸºæœ¬ä¿¡æ¯

**ç»„åç§°**ï¼ˆå¿…å¡«ï¼‰ï¼š
```
ç¤ºä¾‹ï¼šç”Ÿäº§ç¯å¢ƒä¸»KEYç»„
```

**è½®è¯¢ç­–ç•¥**ï¼ˆå¿…å¡«ï¼‰ï¼š
- **é¡ºåºè½®è¯¢**ï¼šæ¯æ¬¡è¯·æ±‚ä¾æ¬¡ä½¿ç”¨ä¸‹ä¸€ä¸ª KEY
- **æ•…éšœåˆ‡æ¢**ï¼šä½¿ç”¨å½“å‰ KEY ç›´åˆ°å‡ºé”™æ‰åˆ‡æ¢

æ¨èæ–°æ‰‹é€‰æ‹©ï¼š**æ•…éšœåˆ‡æ¢**

### æ­¥éª¤ 3ï¼šæ·»åŠ  API å¯†é’¥

åœ¨ **"APIå¯†é’¥åˆ—è¡¨"** æ–‡æœ¬æ¡†ä¸­ï¼Œ**æ¯è¡Œè¾“å…¥ä¸€ä¸ª** Gemini API å¯†é’¥ï¼š

```
AIzaSyABC123def456GHI789jkl...
AIzaSyDEF456ghi789JKL012mno...
AIzaSyGHI789jkl012MNO345pqr...
```

âš ï¸ **æ³¨æ„**ï¼š
- è‡³å°‘éœ€è¦ 1 ä¸ªå¯†é’¥
- æ¯è¡Œä¸€ä¸ªå¯†é’¥
- ä¸è¦æœ‰ç©ºæ ¼æˆ–å…¶ä»–å­—ç¬¦

### æ­¥éª¤ 4ï¼šå¯é€‰é…ç½®

**åŸºç¡€URL**ï¼ˆå¯é€‰ï¼‰ï¼š
- é»˜è®¤ä½¿ç”¨ Google å®˜æ–¹ API åœ°å€
- å¦‚éœ€ä½¿ç”¨ä»£ç†ï¼Œåœ¨æ­¤å¡«å†™ä»£ç†åœ°å€

**æè¿°**ï¼ˆå¯é€‰ï¼‰ï¼š
```
ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ AI éŸ³ä¹ç”ŸæˆåŠŸèƒ½
```

**æ˜¯å¦å¯ç”¨**ï¼š
- âœ… å‹¾é€‰ä»¥ç«‹å³å¯ç”¨æ­¤ KEY ç»„

### æ­¥éª¤ 5ï¼šåˆ›å»º

ç‚¹å‡» **"åˆ›å»ºKEYç»„"** æŒ‰é’®ã€‚

âœ… åˆ›å»ºæˆåŠŸåï¼Œæ‚¨å°†çœ‹åˆ°ï¼š
- KEY ç»„å¡ç‰‡æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
- æ˜¾ç¤º KEY æ€»æ•°ã€å¯ç”¨ KEY æ•°é‡
- æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ KEY
- æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼ˆè¯·æ±‚æ•°ã€æˆåŠŸç‡ç­‰ï¼‰

## ğŸ¯ ä½¿ç”¨ KEY ç»„

### æ–¹å¼ 1ï¼šé€šè¿‡åç«¯ API è°ƒç”¨

```typescript
// åœ¨æ‚¨çš„ä»£ç ä¸­
import { AIClientManagerService } from '@modules/ai-models/services/ai-client-manager.service';

// æ³¨å…¥æœåŠ¡
constructor(
  private readonly aiClientManager: AIClientManagerService,
) {}

// ä½¿ç”¨ KEY ç»„è°ƒç”¨ Gemini
async generateMusic(prompt: string) {
  const keyGroupId = 1; // æ‚¨åˆ›å»ºçš„ KEY ç»„ ID
  
  const response = await this.aiClientManager.createChatCompletionWithKeyGroup(
    keyGroupId,
    {
      messages: [
        { role: 'user', content: prompt }
      ],
      model: 'gemini-pro'
    },
    userId,
    ipAddress,
    userAgent
  );
  
  return response.content;
}
```

### æ–¹å¼ 2ï¼šæŸ¥çœ‹ KEY ç»„ ID

åœ¨ç®¡ç†ç•Œé¢ä¸­ï¼Œæ¯ä¸ª KEY ç»„å¡ç‰‡éƒ½ä¼šæ˜¾ç¤ºå…¶ IDï¼Œæ‚¨éœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ª IDã€‚

## ğŸ” ç›‘æ§å’Œç®¡ç†

### æŸ¥çœ‹ KEY çŠ¶æ€

åœ¨ KEY ç»„å¡ç‰‡ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ¯ä¸ª KEY çš„ï¼š
- **çŠ¶æ€**ï¼šactiveï¼ˆæ­£å¸¸ï¼‰/ errorï¼ˆé”™è¯¯ï¼‰/ exhaustedï¼ˆé…é¢è€—å°½ï¼‰
- **é”™è¯¯æ¬¡æ•°**ï¼šç´¯è®¡é”™è¯¯æ•°
- **æœ€åä½¿ç”¨æ—¶é—´**ï¼šç›¸å¯¹æ—¶é—´æ˜¾ç¤º
- **å½“å‰æ ‡è®°**ï¼šæ˜¾ç¤ºå½“å‰æ­£åœ¨ä½¿ç”¨çš„ KEY

### ç¼–è¾‘ KEY ç»„

1. ç‚¹å‡» KEY ç»„å¡ç‰‡å³ä¾§çš„ **é“…ç¬”å›¾æ ‡**
2. ä¿®æ”¹ç»„åç§°ã€è½®è¯¢ç­–ç•¥ç­‰
3. **æ³¨æ„**ï¼šé‡æ–°å¡«å†™å¯†é’¥åˆ—è¡¨ä¼šæ›¿æ¢æ‰€æœ‰ç°æœ‰å¯†é’¥

### ç§»é™¤å•ä¸ªå¯†é’¥

1. åœ¨å¯†é’¥åˆ—è¡¨ä¸­æ‰¾åˆ°è¦ç§»é™¤çš„å¯†é’¥
2. ç‚¹å‡»å³ä¾§çš„ **åˆ é™¤å›¾æ ‡**
3. ç¡®è®¤åˆ é™¤
4. **æ³¨æ„**ï¼šä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªå¯†é’¥

### é‡ç½® KEY ç»„çŠ¶æ€

å¦‚æœæ‰€æœ‰ KEY éƒ½å‡ºç°é”™è¯¯ï¼Œå¯ä»¥ï¼š
1. ç‚¹å‡» KEY ç»„å³ä¾§çš„ **åˆ·æ–°å›¾æ ‡**
2. ç¡®è®¤é‡ç½®
3. æ‰€æœ‰ KEY çŠ¶æ€å°†é‡ç½®ä¸º `active`
4. é”™è¯¯è®¡æ•°æ¸…é›¶

### åˆ é™¤ KEY ç»„

1. ç‚¹å‡» KEY ç»„å³ä¾§çš„ **åˆ é™¤å›¾æ ‡**
2. ç¡®è®¤åˆ é™¤
3. **è­¦å‘Š**ï¼šæ­¤æ“ä½œä¸å¯æ’¤é”€

## ğŸ’¡ ç­–ç•¥é€‰æ‹©å»ºè®®

### ä½¿ç”¨"é¡ºåºè½®è¯¢"çš„åœºæ™¯ï¼š
- âœ… æ¯ä¸ª KEY çš„é…é¢éƒ½å¾ˆå°‘ï¼ˆå¦‚å…è´¹å±‚ï¼‰
- âœ… éœ€è¦å‡åŒ€ä½¿ç”¨æ‰€æœ‰ KEY
- âœ… è¯·æ±‚é‡å¾ˆå¤§ï¼Œéœ€è¦åˆ†æ•£è´Ÿè½½
- âœ… æƒ³è¦å……åˆ†åˆ©ç”¨æ‰€æœ‰ KEY çš„é…é¢

### ä½¿ç”¨"æ•…éšœåˆ‡æ¢"çš„åœºæ™¯ï¼š
- âœ… ä¸» KEY é…é¢å……è¶³
- âœ… å¤‡ç”¨ KEY ç”¨äºå®¹ç¾
- âœ… ä¸å¸Œæœ›é¢‘ç¹åˆ‡æ¢ KEY
- âœ… è¿½æ±‚ç¨³å®šæ€§ï¼Œåªåœ¨å‡ºé”™æ—¶åˆ‡æ¢

## âš ï¸ å¸¸è§é—®é¢˜

### Q: KEY ç»„åˆ›å»ºåçœ‹ä¸åˆ°çœŸå®çš„å¯†é’¥ï¼Ÿ
**A**: ä¸ºäº†å®‰å…¨ï¼Œå¯†é’¥åŠ å¯†å­˜å‚¨ååªæ˜¾ç¤ºå 8 ä½ï¼ˆåŠ å¯†åçš„ï¼‰ã€‚å¦‚éœ€ä¿®æ”¹å¯†é’¥ï¼Œéœ€è¦é‡æ–°è¾“å…¥å®Œæ•´çš„å¯†é’¥åˆ—è¡¨ã€‚

### Q: æ‰€æœ‰ KEY éƒ½æ˜¾ç¤º "exhausted" æ€ä¹ˆåŠï¼Ÿ
**A**: è¯´æ˜æ‰€æœ‰ KEY çš„é…é¢éƒ½ç”¨å®Œäº†ã€‚æ‚¨å¯ä»¥ï¼š
1. ç­‰å¾…é…é¢é‡ç½®ï¼ˆé€šå¸¸æ¯å¤©é‡ç½®ï¼‰
2. æ·»åŠ æ–°çš„ KEY åˆ°ç»„ä¸­
3. åˆ›å»ºæ–°çš„ KEY ç»„

### Q: é¡ºåºè½®è¯¢æ—¶ï¼Œå¦‚æœæŸä¸ª KEY å¤±æ•ˆä¼šæ€æ ·ï¼Ÿ
**A**: ç³»ç»Ÿä»ä¼šå°è¯•ä½¿ç”¨è¯¥ KEYï¼Œä½†ä¼šè®°å½•é”™è¯¯ã€‚å»ºè®®å®šæœŸæ£€æŸ¥ KEY çŠ¶æ€ï¼Œç§»é™¤å¤±æ•ˆçš„ KEYã€‚

### Q: å¦‚ä½•çŸ¥é“æ­£åœ¨ä½¿ç”¨å“ªä¸ª KEYï¼Ÿ
**A**: KEY ç»„å¡ç‰‡çš„å¯†é’¥åˆ—è¡¨ä¸­ï¼Œå½“å‰ä½¿ç”¨çš„ KEY ä¼šæ ‡è®° **[å½“å‰]**ã€‚

### Q: å¯ä»¥ä¸ºä¸åŒçš„ä¸šåŠ¡åˆ›å»ºä¸åŒçš„ KEY ç»„å—ï¼Ÿ
**A**: å¯ä»¥ï¼æ‚¨å¯ä»¥åˆ›å»ºå¤šä¸ª KEY ç»„ï¼Œæ¯ä¸ªç»„ä½¿ç”¨ä¸åŒçš„ç­–ç•¥å’Œå¯†é’¥é›†åˆã€‚

## ğŸ” å®‰å…¨å»ºè®®

1. **å®šæœŸè½®æ¢å¯†é’¥**ï¼šå»ºè®®æ¯ 1-3 ä¸ªæœˆæ›´æ¢ API å¯†é’¥
2. **æœ€å°æƒé™åŸåˆ™**ï¼šä¸ºæ¯ä¸ª KEY è®¾ç½®åˆé€‚çš„æƒé™
3. **ç›‘æ§å¼‚å¸¸**ï¼šå®šæœŸæ£€æŸ¥é”™è¯¯æ¬¡æ•°ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
4. **å¤‡ä»½é…ç½®**ï¼šè®°å½• KEY ç»„çš„é…ç½®ï¼Œä¾¿äºæ¢å¤
5. **åˆ†ç¦»ç¯å¢ƒ**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ä½¿ç”¨ä¸åŒçš„ KEY ç»„

## ğŸ“Š ç›‘æ§æŒ‡æ ‡è¯´æ˜

åœ¨ KEY ç»„å¡ç‰‡ä¸­æ˜¾ç¤ºçš„ç»Ÿè®¡ä¿¡æ¯ï¼š

- **KEYæ€»æ•°**ï¼šç»„ä¸­åŒ…å«çš„æ‰€æœ‰ KEY æ•°é‡
- **å¯ç”¨KEY**ï¼šçŠ¶æ€ä¸º `active` çš„ KEY æ•°é‡
- **æ€»è¯·æ±‚æ•°**ï¼šä½¿ç”¨æ­¤ KEY ç»„çš„ç´¯è®¡è¯·æ±‚æ¬¡æ•°
- **æˆåŠŸç‡**ï¼šæˆåŠŸè¯·æ±‚ / æ€»è¯·æ±‚çš„ç™¾åˆ†æ¯”

## ğŸ“ æœ€ä½³å®è·µ

### æ¨èé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š

```
ç»„åç§°: ç”Ÿäº§ç¯å¢ƒ Gemini KEYç»„
è½®è¯¢ç­–ç•¥: æ•…éšœåˆ‡æ¢
KEY æ•°é‡: 3-5 ä¸ª
æè¿°: ç”¨äºç”Ÿäº§ç¯å¢ƒ AI åŠŸèƒ½ï¼Œé…é¢å……è¶³çš„ä¸» KEY + å¤‡ç”¨ KEY
```

### æ¨èé…ç½®ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰ï¼š

```
ç»„åç§°: å¼€å‘æµ‹è¯• KEYç»„
è½®è¯¢ç­–ç•¥: é¡ºåºè½®è¯¢
KEY æ•°é‡: 2-3 ä¸ª
æè¿°: ç”¨äºå¼€å‘å’Œæµ‹è¯•ï¼Œå…è´¹å±‚ KEY è½®æµä½¿ç”¨
```

## ğŸ“š æ›´å¤šä¿¡æ¯

- å®Œæ•´åŠŸèƒ½æ–‡æ¡£ï¼š`docs/gemini-key-group-feature.md`
- API æ–‡æ¡£ï¼šhttp://localhost:3000/api/docs
- æŠ€æœ¯å®ç°ç»†èŠ‚ï¼šæŸ¥çœ‹æºä»£ç æ³¨é‡Š

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. âœ… æ•°æ®åº“ migration æ˜¯å¦å·²æ‰§è¡Œ
2. âœ… åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
3. âœ… Gemini API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
4. âœ… æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰**
