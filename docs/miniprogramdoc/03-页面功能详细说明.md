# 页面功能详细说明

## 一、首页 (pages/index/index.vue)

### 页面结构
```
顶部导航栏
├── 应用标题："AI音乐创作"
└── 音乐点数显示：显示用户当前点数余额

功能介绍轮播
├── Banner轮播图（3-5张）
├── 自动播放，5秒切换
└── 点击可跳转详情页

创作提示词区
├── 区域标题："创作提示词"
├── 横向滚动卡片列表
└── 每个卡片包含：
    ├── 图标（emoji）
    ├── 标题
    ├── 描述内容
    ├── 标签（如"欢快"、"夏日"）
    └── 分类标识

热门推荐区
├── 区域标题："热门推荐"
├── "查看全部"链接
└── 音乐列表（最多5首）
    ├── 封面图
    ├── 热门标识
    ├── 标题、艺术家、风格、时长
    ├── 标签
    ├── 播放次数
    └── 播放按钮

创作教程区
├── 区域标题："创作教程"
├── 横向滚动卡片列表
└── 每个卡片包含：
    ├── 教程封面
    ├── 标题
    └── 时长、难度

新手指引区
├── 区域标题："新手指引"
└── 两个引导卡片：
    ├── 自主创作教程
    └── AI辅助创作教程
```

### 核心功能

#### 1. 点数显示与跳转
- **功能**: 显示用户当前音乐点数余额
- **交互**: 点击跳转到音乐点数中心
- **数据来源**: Vuex store + API实时刷新
- **更新时机**: 
  - 页面onLoad时
  - 页面onShow时（从其他页面返回）
  - 点击时手动刷新

#### 2. Banner轮播图
- **数据来源**: API动态获取（/banners/active）
- **默认数据**: 3张本地静态图片（API失败时使用）
- **交互行为**:
  - 有linkUrl：跳转到指定页面或复制链接
  - 无linkUrl：跳转到创作页面
- **图片加载失败**: 自动替换为本地备用图片

#### 3. 创作提示词
- **数据来源**: API动态获取（/prompt-template/list）
- **默认数据**: 5个本地默认模板
- **交互**: 点击提示词卡片 → 跳转到AI创作页面，自动填充提示词内容
- **统计**: 记录提示词使用次数

#### 4. 热门推荐
- **数据来源**: API获取（/hot-recommendation/list）
- **显示数量**: 最多5首
- **交互**:
  - 点击音乐卡片：查看详情
  - 点击播放按钮：预览播放
  - 点击"查看全部"：跳转到热门推荐页
- **统计**: 记录点击和播放次数
- **封面处理**: 仅使用本地静态图片，避免HTTP协议限制

#### 5. 创作教程
- **数据**: 3个固定教程条目
- **交互**: 点击跳转到教程首页

#### 6. 新手指引
- **功能**: 引导新用户学习创作方法
- **交互**: 
  - 点击"自主创作教程" → 跳转到 /pages/tutorial/self
  - 点击"AI辅助创作教程" → 跳转到 /pages/tutorial/ai

### 数据流程
```
页面加载
└── 并行执行：
    ├── 检查自动登录
    ├── 加载点数余额
    ├── 加载Banner数据
    ├── 加载提示词模板
    └── 加载热门推荐

数据加载失败
└── 使用默认数据（不影响用户体验）

用户交互
├── 点击提示词 → 记录统计 → 跳转AI创作页
├── 点击音乐 → 记录点击 → 查看详情
├── 点击播放 → 记录播放 → 播放音乐
└── 点击点数 → 刷新点数 → 跳转点数中心
```

---

## 二、创作流程页面

### 1. 创作方式选择 (pages/creation/select.vue)

#### 页面布局
```
标题："选择创作方式"

自己写歌词卡片
├── 图标: ✏️
├── 标题: "自己写歌词"
├── 描述: "自由发挥创意，写下你的歌词，AI将为你谱曲"
└── 右箭头

AI帮我写卡片
├── 图标: ✏️
├── 标题: "AI 帮我写"
├── 描述: "告诉AI你的创作想法，它将为你生成完整歌词"
└── 右箭头

奖励提示
└── "首次创作将获得额外10音乐点数奖励"
```

#### 核心功能

**1. 登录检查**
- 点击任一创作方式前，先检查登录状态
- 未登录：调用微信授权登录流程
- 已登录：继续创作流程

**2. 版权弹窗（首次创作）**
- 检查本地存储：hasCreatedBefore
- 首次创作：显示版权说明弹窗
- 内容包括：
  - 歌词版权归用户所有
  - AI内容使用权归用户，无商业使用权
  - 平台展示推广权
  - 违规内容禁止

**3. 路由跳转**
- 自己写歌词 → `/pages/creation/manual`
- AI帮我写 → `/pages/creation/ai`

### 2. 自主创作页面 (pages/creation/manual.vue)

#### 页面结构
```
歌曲标题输入
├── 标签："歌曲标题"
├── 输入框（最多20字）
└── 字数统计: "X/20"

违规内容提示
└── "请勿输入违规、侵权或敏感内容，系统将自动审核"

歌词内容输入
├── 标签："歌词内容"
├── "最多400字" + 复制图标
├── 大文本输入框
└── 字数统计: "X/400"
    ├── 正常: 灰色
    ├── 警告(>360): 橙色
    └── 超限(>400): 红色

底部操作
└── "下一步"按钮（灰色禁用/渐变可用）
```

#### 核心功能

**1. 表单验证**
- 标题：必填，不能为空，最多20字
- 歌词：必填，不能为空，最多400字
- 实时字数统计和颜色提示

**2. 自动保存草稿**
- 保存到本地存储：manual_draft
- 保存内容：标题、歌词、保存时间
- 自动保存间隔：30秒
- 触发保存：内容变化时标记为isDirty
- 页面退出时保存

**3. 草稿恢复**
- onLoad时自动恢复本地草稿
- 显示最后保存时间

**4. 复制歌词功能**
- 点击复制图标
- 调用uni.setClipboardData

**5. 返回提示**
- 有未保存修改时弹窗提示
- 选项：保存后离开 / 不保存直接离开

**6. 进行下一步**
- 跳转到风格选择页
- 携带参数：
  ```javascript
  {
    type: 'manual',
    title: encodeURIComponent(标题),
    lyrics: encodeURIComponent(歌词)
  }
  ```

### 3. AI辅助创作页面 (pages/creation/ai.vue)

#### 页面结构（过长，仅列出核心结构）
```
创作提示输入
├── 标签："告诉AI你的创作想法"
├── 文本输入框
└── 字数统计

示例提示词卡片
├── 多个预设提示词
└── 点击可快速填入

生成歌词按钮
└── "生成歌词" (渐变按钮)

生成结果区
├── 生成的歌词文本
├── 编辑按钮
├── 重新生成按钮
└── "下一步"按钮
```

#### 核心功能

**1. 提示词输入**
- 支持自由输入创作想法
- 字数限制：500字
- 实时字数统计

**2. 示例提示词**
- 显示多个预设提示词
- 点击可快速填入输入框
- 提示词内容包括主题、风格、情感等

**3. AI歌词生成**
- 调用API：/ai/lyrics/generate
- 显示生成进度动画
- 生成时间：预计30-60秒
- 消耗点数：20点

**4. 歌词编辑**
- 生成后可编辑歌词
- 实时保存修改

**5. 重新生成**
- 保持当前提示词
- 重新调用生成API
- 消耗额外点数

**6. 进行下一步**
- 跳转到风格选择页
- 携带生成的歌词和标题

### 4. 风格设置页面 (pages/creation/style.vue)

#### 页面结构
```
风格类型选择
├── 标签："风格类型"
└── 3列网格布局（12种风格）
    ├── 流行、摇滚、民谣
    ├── 电子、R&B、嘻哈
    ├── 古典、爵士、乡村
    └── 抒情、EDM、独立

声音性别选择
├── 标签："声音性别"
└── 3个选项
    ├── 男声
    ├── 女声
    └── 中性

底部操作
├── "返回修改歌词"按钮
└── "下一步"按钮
```

#### 核心功能

**1. 风格选择**
- 单选，默认：流行
- 点击切换选中状态
- 选中样式：蓝色边框+背景高亮

**2. 声音选择**
- 单选，默认：女声
- 点击切换选中状态
- 选中样式：蓝色边框+背景高亮

**3. 示例试听（已注释）**
- 原设计支持声音示例试听
- 当前版本未启用

**4. 进行下一步**
- 跳转到预览生成页
- 携带参数：
  ```javascript
  {
    type: 创作类型,
    title: 标题,
    lyrics: 歌词,
    style: 选中风格ID,
    voice: 选中声音ID
  }
  ```

### 5. 音乐预览页面 (pages/creation/preview.vue)

#### 页面状态

**状态1：确认信息（初始状态）**
```
确认创作信息
├── 音乐风格：XX
├── 声音类型：XX
├── "生成音乐"按钮
└── "将消耗30音乐点数"提示
```

**状态2：生成中**
```
加载动画
├── 旋转圆圈动画
└── "AI正在创作中"文字

生成进度条
├── 进度百分比（0-100%）
└── 进度文字

提示信息
├── "正在将您的歌词谱写成优美旋律"
├── "预计需要30-60秒完成创作"
└── "请耐心等待，我们将为您带来精彩作品"
```

**状态3：生成完成**
```
唱片展示
├── 旋转的唱片图片（播放时）
├── 歌曲标题
└── 风格/声音类型

进度条
├── 当前时间 / 总时长
├── 进度条
└── 拖动手柄

播放控制
├── 上一首按钮
├── 播放/暂停按钮（大圆形）
└── 下一首按钮

歌词展示（隐藏）
├── 歌词内容
└── 展开/收起按钮

操作按钮
├── 下载按钮
└── 分享按钮
```

#### 核心功能

**1. 生成音乐**
- 检查点数是否足够（需要30点）
- 点数不足：提示并跳转到购买页
- 点数足够：
  - 扣除30点
  - 开始生成动画
  - 模拟生成进度（实际应调用API）

**2. 进度模拟**
- 使用setInterval模拟进度
- 每800ms增加随机进度（0-5%）
- 达到100%后延迟500ms显示结果

**3. 音频播放**
- 初始化音频上下文：uni.createInnerAudioContext()
- 监听播放事件：onPlay、onPause、onStop、onEnded
- 播放/暂停切换
- 实时更新播放进度

**4. 进度控制**
- 显示当前时间和总时长
- 进度条随播放自动更新（每250ms刷新）
- 点击进度条跳转到指定位置

**5. 下载音乐**
- 显示下载进度提示
- 实际项目需调用下载API

**6. 分享音乐**
- 调用微信分享接口
- 分享标题、描述、封面

**7. 保存到作品库**
- 调用保存API
- 保存成功后返回首页

---

## 三、用户中心页面

### 1. 个人中心首页 (pages/user/index.vue)

#### 页面结构
```
用户信息卡片
├── 头像
├── 用户名/昵称
├── 点数余额
└── 签到按钮

功能入口网格
├── 我的作品
├── 音乐点数
├── 每日签到
├── 帮助中心
├── 意见反馈
└── 关于我们

设置与其他
├── 系统设置
├── 用户协议
├── 隐私政策
└── 版权说明
```

### 2. 我的作品页面 (pages/user/works.vue)

#### 功能
- 显示用户所有创作的音乐作品
- 筛选：全部/已完成/生成中/失败
- 搜索：按标题搜索
- 排序：按时间/播放量
- 操作：播放、编辑、删除、分享

### 3. 音乐点数中心 (pages/user/points.vue)

#### 功能
- 点数余额大图显示
- 点数使用记录列表
- 点数获取记录列表
- 点数统计图表
- "购买点数"按钮
- "每日签到"入口

### 4. 购买点数页面 (pages/user/purchase.vue)

#### 功能
- 显示多个点数套餐
- 套餐信息：点数量、价格、优惠标签
- 选择套餐
- 微信支付
- 订单查询

---

## 四、其他页面

### 1. 热门推荐页面 (pages/recommendations/index.vue)

#### 页面结构
```
顶部导航
├── 返回按钮
├── "热门推荐"标题
└── 搜索按钮

分类标签
└── 全部/流行/电子/民谣/摇滚/古典/爵士（横向滚动）

音乐列表
└── 每首音乐包含：
    ├── 排名序号
    ├── 封面（带热门标识）
    ├── 标题、艺术家、风格
    ├── 标签
    ├── 播放次数、时长
    ├── 播放按钮
    └── 喜欢按钮

底部
├── "加载中..."
└── "没有更多了"
```

#### 核心功能
- 分类筛选
- 分页加载（scrolltolower）
- 搜索功能（弹窗）
- 音乐播放预览
- 点赞/取消点赞
- 播放和点击统计

### 2. 教程首页 (pages/tutorial/index.vue)

#### 功能
- 分类筛选
- 视频教程列表（带封面和播放图标）
- 图文教程（AI辅助/自主创作完整指南）
- 6步骤流程说明
- 常见问题FAQ（可展开/收起）
- 进阶教程列表

---

## 数据交互流程总结

### 创作流程数据流
```
选择创作方式
├── 检查登录
└── 显示版权说明（首次）

↓

自主创作 / AI辅助创作
├── 输入内容
├── 自动保存草稿
└── 验证通过

↓

风格选择
├── 选择音乐风格
└── 选择声音性别

↓

音乐预览
├── 确认信息
├── 消耗点数（30点）
├── 生成音乐（模拟/API）
├── 播放预览
└── 下载/分享/保存
```

### 用户数据流
```
登录
└── 微信授权 → 获取token → 存储到Vuex和本地

↓

获取用户信息
├── 点数余额
├── 用户资料
└── 统计信息

↓

创作消费点数
└── 扣除点数 → 更新余额 → 刷新显示

↓

购买点数
└── 选择套餐 → 微信支付 → 充值点数 → 更新余额
```
