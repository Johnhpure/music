# 组件与工具函数

## 一、公共组件

### 1. uni-ui 官方组件

#### uni-nav-bar (导航栏)
- **路径**: `components/uni-nav-bar/uni-nav-bar.vue`
- **功能**: 自定义导航栏组件
- **属性**:
  - title: 标题
  - leftIcon: 左侧图标
  - rightIcon: 右侧图标
  - backgroundColor: 背景色
  - statusBar: 是否包含状态栏

#### uni-status-bar (状态栏占位)
- **路径**: `components/uni-status-bar/uni-status-bar.vue`
- **功能**: 状态栏占位组件
- **用途**: 适配不同设备的状态栏高度

#### uni-card (卡片)
- **路径**: `components/uni-card/uni-card.vue`
- **功能**: 通用卡片容器
- **属性**:
  - title: 卡片标题
  - extra: 右侧额外信息
  - thumbnail: 缩略图
  - isShadow: 是否显示阴影

#### uni-list / uni-list-item (列表)
- **路径**: 
  - `components/uni-list/uni-list.vue`
  - `components/uni-list-item/uni-list-item.vue`
- **功能**: 列表容器和列表项
- **属性**:
  - title: 标题
  - note: 描述
  - thumb: 左侧图标
  - rightText: 右侧文字
  - showArrow: 显示右箭头

#### uni-tag (标签)
- **路径**: `components/uni-tag/uni-tag.vue`
- **功能**: 标签组件
- **属性**:
  - text: 标签文字
  - type: 类型（default/primary/success/warning/error）
  - size: 尺寸（normal/small）

#### uni-badge (徽标)
- **路径**: `components/uni-badge/uni-badge.vue`
- **功能**: 数字角标
- **属性**:
  - text: 显示文字/数字
  - type: 类型（default/primary/success/warning/error）
  - max: 最大值，超出显示{max}+

#### uni-popup (弹窗)
- **路径**: `components/uni-popup/uni-popup.vue`
- **功能**: 通用弹窗组件
- **属性**:
  - type: 弹窗类型（top/center/bottom）
  - maskClick: 点击遮罩是否关闭
- **方法**:
  - open(): 打开弹窗
  - close(): 关闭弹窗

#### uni-icons (图标)
- **路径**: `components/uni-icons/uni-icons.vue`
- **功能**: 图标组件
- **属性**:
  - type: 图标类型
  - size: 图标大小
  - color: 图标颜色

#### uni-goods-nav (商品导航)
- **路径**: `components/uni-goods-nav/uni-goods-nav.vue`
- **功能**: 底部商品导航栏
- **属性**:
  - options: 左侧按钮组
  - buttonGroup: 右侧按钮组

### 2. 第三方组件

#### mescroll-uni (滚动加载)
- **路径**: `components/mescroll-uni/`
- **功能**: 下拉刷新和上拉加载
- **文件**:
  - mescroll-uni.vue: 主组件
  - mescroll-uni.js: 核心逻辑
  - mescroll-uni-option.js: 配置选项
  - mescroll-uni.css: 样式
- **特性**:
  - 支持下拉刷新
  - 支持上拉加载更多
  - 自动管理加载状态
  - 高度可配置

**使用示例**:
```vue
<template>
  <mescroll-uni @init="mescrollInit" @down="downCallback" @up="upCallback">
    <view v-for="item in list" :key="item.id">
      <!-- 列表项内容 -->
    </view>
  </mescroll-uni>
</template>

<script>
export default {
  data() {
    return {
      mescroll: null,
      list: [],
      page: 1
    }
  },
  methods: {
    mescrollInit(mescroll) {
      this.mescroll = mescroll
    },
    downCallback(mescroll) {
      // 下拉刷新
      this.page = 1
      this.loadData().then(() => {
        mescroll.endSuccess()
      })
    },
    upCallback(page, mescroll) {
      // 上拉加载
      this.page = page.num
      this.loadData().then((hasMore) => {
        mescroll.endBySize(list.length, hasMore)
      })
    }
  }
}
</script>
```

#### tui-datetime (日期时间选择)
- **路径**: `components/tui/tui-datetime.vue`
- **功能**: 日期时间选择器
- **用途**: 签到日历、时间选择

### 3. 自定义登录组件

#### watch-input (登录输入框)
- **路径**: `components/watch-login/watch-input.vue`
- **功能**: 自定义登录输入框
- **属性**:
  - type: 输入类型（text/password）
  - placeholder: 占位文字
  - maxlength: 最大长度
  - isShowPass: 是否显示密码切换图标
- **样式**: `components/watch-login/css/icon.css`

#### watch-button (登录按钮)
- **路径**: `components/watch-login/watch-button.vue`
- **功能**: 自定义登录按钮
- **属性**:
  - text: 按钮文字
  - rotate: 是否显示旋转加载动画

### 4. ColorUI 组件

#### cu-custom (自定义导航栏)
- **路径**: `colorui/components/cu-custom.vue`
- **功能**: ColorUI风格的自定义导航栏
- **特性**:
  - 支持状态栏适配
  - 支持自定义背景色
  - 支持插槽自定义内容

---

## 二、工具函数库

### 1. MinRequest (HTTP请求封装)

**文件路径**: `utils/MinRequest.js`

**功能**:
- 基于uni.request封装的HTTP请求库
- 支持请求/响应拦截器
- 统一错误处理
- 自动添加token

**核心方法**:
```javascript
class MinRequest {
  // GET请求
  get(url, params, config)
  
  // POST请求
  post(url, data, config)
  
  // PUT请求
  put(url, data, config)
  
  // DELETE请求
  delete(url, params, config)
  
  // PATCH请求
  patch(url, data, config)
  
  // 设置配置
  setConfig(fn)
  
  // 请求拦截器
  interceptors.request(fn)
  
  // 响应拦截器
  interceptors.response(fn)
}
```

**使用示例**:
```javascript
// 在api.js中初始化
const minRequest = new MinRequest()

// 请求拦截器
minRequest.interceptors.request((request) => {
  const token = store.getters.user?.token
  if (token) {
    request.header = {
      ...request.header,
      'Authorization': `Bearer ${token}`
    }
  }
  return request
})

// 响应拦截器
minRequest.interceptors.response((response) => {
  if (response.statusCode === 401) {
    // 处理未授权
  }
  return response.data
})

// 设置基础URL
minRequest.setConfig((config) => {
  config.baseURL = 'http://192.168.1.118:3000/api'
  return config
})
```

### 2. MinCache (缓存管理)

**文件路径**: `utils/MinCache.js`

**功能**:
- uni.storage的增强封装
- 支持过期时间
- 支持命名空间
- 自动清理过期数据

**核心方法**:
```javascript
// 设置缓存（支持过期时间）
MinCache.set(key, value, expire)

// 获取缓存
MinCache.get(key)

// 删除缓存
MinCache.remove(key)

// 清空所有缓存
MinCache.clear()

// 检查是否存在
MinCache.has(key)
```

### 3. MinRouter (路由管理)

**文件路径**: `utils/MinRouter.js`

**功能**:
- 路由跳转的统一封装
- 自动区分TabBar和普通页面
- 支持路由守卫
- 支持传参处理

**核心方法**:
```javascript
class MinRouter {
  // 导航到页面
  push(options)
  
  // 重定向
  replace(options)
  
  // 返回上一页
  back(delta)
  
  // 跳转TabBar
  switchTab(url)
  
  // 重新加载
  reLaunch(url)
}
```

### 4. 微信授权工具

#### wechatAuth.js (基础授权)
**文件路径**: `utils/wechatAuth.js`

**功能**:
- 微信小程序授权登录
- 获取用户信息
- 获取手机号
- Token管理

**核心方法**:
```javascript
// 微信登录
wechatLogin()

// 获取用户信息
getUserProfile()

// 获取手机号
getPhoneNumber(e)

// 检查登录状态
isLoggedIn()

// 获取本地用户信息
getUserInfo()

// 退出登录
logout()

// 检查创作功能登录
checkCreationLogin(type)
```

#### wechatAuthNew.js (新版授权)
**文件路径**: `utils/wechatAuthNew.js`

**功能**: 新版微信授权API支持

#### wechatAuthComplete.js (完整授权流程)
**文件路径**: `utils/wechatAuthComplete.js`

**功能**: 完整的授权流程管理

### 5. 其他工具函数

#### datetime.js (日期时间处理)
**文件路径**: `utils/datetime.js`

**功能**:
- 日期格式化
- 时间差计算
- 相对时间显示

**核心方法**:
```javascript
// 格式化日期
formatDate(date, format)

// 相对时间（如"3分钟前"）
relativeTime(date)

// 时间差
dateDiff(date1, date2)
```

#### checkResponse.js (响应检查)
**文件路径**: `utils/checkResponse.js`

**功能**:
- 统一的API响应检查
- 错误处理和提示

#### graceChecker.js (表单验证)
**文件路径**: `utils/graceChecker.js`

**功能**:
- 表单字段验证
- 支持多种验证规则

**验证规则**:
```javascript
const rules = [
  { name: 'username', checkType: 'notnull', errorMsg: '用户名不能为空' },
  { name: 'phone', checkType: 'phoneno', errorMsg: '手机号格式不正确' },
  { name: 'email', checkType: 'email', errorMsg: '邮箱格式不正确' }
]

graceChecker.check(data, rules)
```

---

## 三、公共样式

### 1. ColorUI 样式库

**文件路径**: `colorui/`

#### main.css
- ColorUI主样式文件
- 包含通用样式类
- 颜色系统
- 间距系统

#### icon.css
- 图标字体样式
- 提供丰富的图标库

#### animation.css
- 动画效果类
- 包含各种动画效果

### 2. 自定义全局样式

#### common.css
**文件路径**: `common/css/common.css`

- 全局通用样式
- 重置样式
- 工具类

#### uni.css
**文件路径**: `common/css/uni.css`

- uni-app默认样式
- 组件基础样式

#### iconfont.css
**文件路径**: `common/css/iconfont.css`

- 自定义图标字体

### 3. 主题样式

#### custom-dark.less
**文件路径**: `common/css/custom-dark.less`

- 暗色主题样式
- CSS变量定义

#### custom-light.less
**文件路径**: `common/css/custom-light.less`

- 亮色主题样式
- CSS变量定义

---

## 四、第三方库

### 1. lodash
**文件路径**: 通过npm引入
**用途**: JavaScript实用工具库
**主要使用**:
- 数组操作
- 对象操作
- 防抖节流

### 2. md5
**文件路径**: `common/lib/md5.min.js`
**用途**: MD5加密
**使用场景**: 密码加密

### 3. u-charts
**文件路径**: `common/lib/u-charts.min.js`
**用途**: 图表库
**使用场景**: 点数统计图表

---

## 五、国际化 (i18n)

**文件路径**: `i18n/`

### 语言文件

#### zh-CN.js (简体中文)
```javascript
export default {
  common: {
    confirm: '确定',
    cancel: '取消',
    submit: '提交'
  },
  home: {
    title: 'AI音乐创作'
  }
  // ...
}
```

#### en-US.js (英文)
```javascript
export default {
  common: {
    confirm: 'Confirm',
    cancel: 'Cancel',
    submit: 'Submit'
  },
  home: {
    title: 'AI Music Creation'
  }
  // ...
}
```

#### index.js (配置入口)
```javascript
import Vue from 'vue'
import VueI18n from 'vue-i18n'
import zhCN from './zh-CN'
import enUS from './en-US'

Vue.use(VueI18n)

export default new VueI18n({
  locale: 'zh-CN',
  messages: {
    'zh-CN': zhCN,
    'en-US': enUS
  }
})
```

### 使用方式
```vue
<template>
  <view>{{ $t('home.title') }}</view>
</template>
```

---

## 六、组件使用最佳实践

### 1. 列表组件使用
```vue
<template>
  <mescroll-uni @init="mescrollInit" @down="downCallback" @up="upCallback">
    <uni-list>
      <uni-list-item 
        v-for="item in list" 
        :key="item.id"
        :title="item.title"
        :note="item.description"
        showArrow
        @click="handleClick(item)"
      />
    </uni-list>
  </mescroll-uni>
</template>
```

### 2. 弹窗组件使用
```vue
<template>
  <view>
    <button @click="showPopup">打开弹窗</button>
    <uni-popup ref="popup" type="center">
      <view class="popup-content">
        <!-- 弹窗内容 -->
      </view>
    </uni-popup>
  </view>
</template>

<script>
export default {
  methods: {
    showPopup() {
      this.$refs.popup.open()
    }
  }
}
</script>
```

### 3. 卡片组件使用
```vue
<template>
  <uni-card 
    :title="title"
    :extra="extra"
    :thumbnail="thumbnail"
    isShadow
  >
    <view>卡片内容</view>
  </uni-card>
</template>
```
