# ä¸ªäººä¸­å¿ƒç›´æ¥æˆæƒå¤´åƒå’Œæ˜µç§°åŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ¨ä¸ªäººä¸­å¿ƒé¡µé¢ç›´æ¥ç‚¹å‡»å¤´åƒæˆ–æ˜µç§°ï¼Œå³å¯è§¦å‘å¾®ä¿¡æˆæƒæ“ä½œï¼Œæ— éœ€è·³è½¬æ–°é¡µé¢ï¼Œæä¾›æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… ç‚¹å‡»å¤´åƒ â†’ ç›´æ¥è§¦å‘å¾®ä¿¡å¤´åƒé€‰æ‹©å™¨
- âœ… ç‚¹å‡»æ˜µç§° â†’ å¼¹å‡ºæ˜µç§°ç¼–è¾‘å¯¹è¯æ¡†
- âœ… ä½¿ç”¨å¾®ä¿¡æœ€æ–°çš„å¤´åƒæ˜µç§°å¡«å†™èƒ½åŠ›
- âœ… åœ¨å½“å‰é¡µé¢å®Œæˆæ‰€æœ‰æ“ä½œ
- âœ… è‡ªåŠ¨ä¸Šä¼ å¹¶ä¿å­˜åˆ°åç«¯
- âœ… å®æ—¶æ›´æ–°é¡µé¢æ˜¾ç¤º
- âœ… å®Œå–„çš„åŠ è½½å’Œé”™è¯¯æç¤º

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### ç”¨æˆ·æ“ä½œæµç¨‹

#### 1. æ›´æ¢å¤´åƒ

```
ç”¨æˆ·æ‰“å¼€ä¸ªäººä¸­å¿ƒ
    â†“
ç‚¹å‡»é¡¶éƒ¨å¤´åƒ
    â†“
å¾®ä¿¡å¼¹å‡ºå¤´åƒé€‰æ‹©å™¨
    â†“
ä»ç›¸å†Œé€‰æ‹©æˆ–æ‹ç…§
    â†“
è‡ªåŠ¨ä¸Šä¼ å¹¶ä¿å­˜
    â†“
å¤´åƒç«‹å³æ›´æ–°æ˜¾ç¤º
```

**æ“ä½œæ¼”ç¤º**ï¼š
1. è¿›å…¥"æˆ‘çš„"Tab
2. ç‚¹å‡»ä¸ªäººä¿¡æ¯å¡ç‰‡ä¸­çš„å¤´åƒ
3. åœ¨å¾®ä¿¡å¤´åƒé€‰æ‹©å™¨ä¸­é€‰æ‹©å›¾ç‰‡
4. ç­‰å¾…"ä¿å­˜å¤´åƒä¸­..."æç¤º
5. çœ‹åˆ°"å¤´åƒæ›´æ–°æˆåŠŸ"æç¤º
6. å¤´åƒç«‹å³æ›´æ–°

#### 2. ä¿®æ”¹æ˜µç§°

```
ç”¨æˆ·æ‰“å¼€ä¸ªäººä¸­å¿ƒ
    â†“
ç‚¹å‡»æ˜µç§°"éŸ³ä¹åˆ›ä½œè€…"
    â†“
å¼¹å‡ºæ˜µç§°ç¼–è¾‘å¯¹è¯æ¡†
    â†“
è¾“å…¥æ–°æ˜µç§°
    â†“
ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
    â†“
æ˜µç§°ç«‹å³æ›´æ–°æ˜¾ç¤º
```

**æ“ä½œæ¼”ç¤º**ï¼š
1. è¿›å…¥"æˆ‘çš„"Tab
2. ç‚¹å‡»ä¸ªäººä¿¡æ¯å¡ç‰‡ä¸­çš„æ˜µç§°æ–‡å­—
3. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥æ–°æ˜µç§°
4. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
5. ç­‰å¾…"ä¿å­˜ä¸­..."æç¤º
6. çœ‹åˆ°"æ˜µç§°æ›´æ–°æˆåŠŸ"æç¤º
7. å¯¹è¯æ¡†è‡ªåŠ¨å…³é—­ï¼Œæ˜µç§°ç«‹å³æ›´æ–°

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### 1. æ–‡ä»¶ç»“æ„

```
miniprogram/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ user/
â”‚       â””â”€â”€ index.vue           # ä¸ªäººä¸­å¿ƒé¡µé¢ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ api/
â”‚   â””â”€â”€ api.js                  # APIæ¥å£ï¼ˆå·²æ·»åŠ ï¼‰
â””â”€â”€ USER_AVATAR_NICKNAME_FEATURE.md  # æœ¬æ–‡æ¡£
```

### 2. æ ¸å¿ƒä»£ç å®ç°

#### 2.1 å¤´åƒé€‰æ‹©ï¼ˆTemplateéƒ¨åˆ†ï¼‰

```vue
<template>
  <!-- ä½¿ç”¨buttonåŒ…è£¹imageï¼Œè®¾ç½®open-type -->
  <button 
    class="avatar-button" 
    open-type="chooseAvatar" 
    @chooseavatar="onChooseAvatar"
  >
    <image class="user-avatar" :src="userImage"></image>
  </button>
</template>
```

**å…³é”®ç‚¹**ï¼š
- `open-type="chooseAvatar"` - è§¦å‘å¾®ä¿¡å¤´åƒé€‰æ‹©å™¨
- `@chooseavatar` - é€‰æ‹©å®Œæˆåçš„å›è°ƒ
- `avatar-button` - æ ·å¼é‡ç½®ï¼Œä½¿buttonçœ‹èµ·æ¥åƒimage

#### 2.2 å¤´åƒé€‰æ‹©ï¼ˆScriptéƒ¨åˆ†ï¼‰

```javascript
/**
 * é€‰æ‹©å¤´åƒå›è°ƒ
 */
async onChooseAvatar(e) {
  const { avatarUrl } = e.detail
  
  // æ›´æ–°é¡µé¢æ˜¾ç¤º
  this.userImage = avatarUrl
  
  // æ˜¾ç¤ºæç¤º
  uni.showToast({
    title: 'å¤´åƒå·²é€‰æ‹©',
    icon: 'success'
  })
  
  // è‡ªåŠ¨ä¸Šä¼ å¹¶ä¿å­˜
  this.saveAvatar(avatarUrl)
},

/**
 * ä¸Šä¼ å¹¶ä¿å­˜å¤´åƒ
 */
async saveAvatar(avatarUrl) {
  try {
    uni.showLoading({ title: 'ä¿å­˜å¤´åƒä¸­...' })
    
    // è°ƒç”¨APIä¿å­˜
    const result = await this.$minApi.updateUserProfile({
      avatar: avatarUrl
    })
    
    if (result.code === 200) {
      // æ›´æ–°æœ¬åœ°å­˜å‚¨
      const userInfo = uni.getStorageSync('userInfo') || {}
      userInfo.avatar = avatarUrl
      uni.setStorageSync('userInfo', userInfo)
      
      uni.showToast({
        title: 'å¤´åƒæ›´æ–°æˆåŠŸ',
        icon: 'success'
      })
    }
  } catch (error) {
    uni.showToast({
      title: 'ä¿å­˜å¤´åƒå¤±è´¥',
      icon: 'none'
    })
    // æ¢å¤åŸå¤´åƒ
    this.loadUserInfo()
  }
}
```

#### 2.3 æ˜µç§°ç¼–è¾‘ï¼ˆTemplateéƒ¨åˆ†ï¼‰

```vue
<template>
  <!-- ç‚¹å‡»æ˜µç§°å¼¹å‡ºç¼–è¾‘æ¡† -->
  <text class="user-name" @click="showNicknameModal">{{ userName }}</text>
  
  <!-- æ˜µç§°ç¼–è¾‘å¼¹çª— -->
  <view v-if="nicknameModalVisible" class="modal-overlay" @click="hideNicknameModal">
    <view class="modal-content" @click.stop>
      <view class="modal-header">
        <text class="modal-title">ç¼–è¾‘æ˜µç§°</text>
        <text class="modal-close" @click="hideNicknameModal">âœ•</text>
      </view>
      <view class="modal-body">
        <input 
          class="nickname-input" 
          type="nickname"
          v-model="tempNickname"
          placeholder="è¯·è¾“å…¥æ˜µç§°"
          @confirm="saveNickname"
        />
      </view>
      <view class="modal-footer">
        <button class="modal-button cancel" @click="hideNicknameModal">å–æ¶ˆ</button>
        <button class="modal-button confirm" @click="saveNickname">ä¿å­˜</button>
      </view>
    </view>
  </view>
</template>
```

**å…³é”®ç‚¹**ï¼š
- `type="nickname"` - è§¦å‘å¾®ä¿¡æ˜µç§°å®‰å…¨æ£€æµ‹
- `v-if="nicknameModalVisible"` - æ§åˆ¶å¼¹çª—æ˜¾ç¤º
- `@click.stop` - é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢ç‚¹å‡»å†…å®¹æ—¶å…³é—­å¼¹çª—

#### 2.4 æ˜µç§°ç¼–è¾‘ï¼ˆScriptéƒ¨åˆ†ï¼‰

```javascript
/**
 * æ˜¾ç¤ºæ˜µç§°ç¼–è¾‘å¼¹çª—
 */
showNicknameModal() {
  // å¦‚æœæ˜¯é»˜è®¤æ˜µç§°ï¼Œæ¸…ç©ºè¾“å…¥æ¡†
  this.tempNickname = this.userName === 'éŸ³ä¹åˆ›ä½œè€…' ? '' : this.userName
  this.nicknameModalVisible = true
},

/**
 * éšè—æ˜µç§°ç¼–è¾‘å¼¹çª—
 */
hideNicknameModal() {
  this.nicknameModalVisible = false
  this.tempNickname = ''
},

/**
 * ä¿å­˜æ˜µç§°
 */
async saveNickname() {
  // éªŒè¯è¾“å…¥
  if (!this.tempNickname || !this.tempNickname.trim()) {
    uni.showToast({
      title: 'è¯·è¾“å…¥æ˜µç§°',
      icon: 'none'
    })
    return
  }
  
  const nickname = this.tempNickname.trim()
  
  try {
    uni.showLoading({ title: 'ä¿å­˜ä¸­...' })
    
    // è°ƒç”¨APIä¿å­˜
    const result = await this.$minApi.updateUserProfile({
      nickname: nickname
    })
    
    if (result.code === 200) {
      // æ›´æ–°æœ¬åœ°å­˜å‚¨
      const userInfo = uni.getStorageSync('userInfo') || {}
      userInfo.nickname = nickname
      uni.setStorageSync('userInfo', userInfo)
      
      // æ›´æ–°é¡µé¢æ˜¾ç¤º
      this.userName = nickname
      
      // å…³é—­å¼¹çª—
      this.hideNicknameModal()
      
      uni.showToast({
        title: 'æ˜µç§°æ›´æ–°æˆåŠŸ',
        icon: 'success'
      })
    }
  } catch (error) {
    uni.showToast({
      title: 'ä¿å­˜æ˜µç§°å¤±è´¥',
      icon: 'none'
    })
  }
}
```

#### 2.5 æ ·å¼å®ç°

```less
// å¤´åƒæŒ‰é’®æ ·å¼ï¼ˆå»é™¤buttoné»˜è®¤æ ·å¼ï¼‰
.avatar-button {
  padding: 0;
  margin: 0;
  border: none;
  background: transparent;
  line-height: 1;
  
  &::after {
    border: none;
  }
}

.user-avatar {
  width: 120rpx;
  height: 120rpx;
  border-radius: 50%;
  border: 2rpx solid #0B67EC;
  margin-right: 20rpx;
  display: block;
}

// æ˜µç§°ç¼–è¾‘å¼¹çª—æ ·å¼
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.modal-content {
  width: 600rpx;
  background-color: #1E1E1E;
  border-radius: 20rpx;
  overflow: hidden;
}

// ... æ›´å¤šæ ·å¼è§ä»£ç 
```

---

## ğŸ”Œ åç«¯APIå¯¹æ¥

### æ›´æ–°ç”¨æˆ·èµ„æ–™æ¥å£

**æ¥å£**: `PUT /api/v1/user/profile`

**è¯·æ±‚å¤´**:
```
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:
```json
{
  "nickname": "æ–°æ˜µç§°",      // å¯é€‰
  "avatar": "å¤´åƒURL"        // å¯é€‰
}
```

**æˆåŠŸå“åº”**:
```json
{
  "code": 200,
  "msg": "æ›´æ–°æˆåŠŸ",
  "data": {
    "id": "123",
    "nickname": "æ–°æ˜µç§°",
    "avatar": "å¤´åƒURL",
    ...
  }
}
```

---

## ğŸ“± å¾®ä¿¡å°ç¨‹åºAPIè¯´æ˜

### 1. button open-type="chooseAvatar"

**åŠŸèƒ½**: æ‰“å¼€å¾®ä¿¡åŸç”Ÿå¤´åƒé€‰æ‹©å™¨

**æ”¯æŒç‰ˆæœ¬**: å¾®ä¿¡åŸºç¡€åº“ 2.21.2+

**è¿”å›æ•°æ®**:
```javascript
{
  avatarUrl: "wxfile://tmp_xxx.jpg"  // å¾®ä¿¡ä¸´æ—¶æ–‡ä»¶è·¯å¾„
}
```

**ç‰¹æ€§**:
- âœ… æ— éœ€é¢å¤–æˆæƒ
- âœ… æ”¯æŒç›¸å†Œå’Œæ‹ç…§
- âœ… è¿”å›ä¸´æ—¶è·¯å¾„
- âœ… ç”¨æˆ·ä½“éªŒå‹å¥½

### 2. input type="nickname"

**åŠŸèƒ½**: æ˜µç§°è¾“å…¥æ¡†ï¼ˆå¸¦å®‰å…¨æ£€æµ‹ï¼‰

**æ”¯æŒç‰ˆæœ¬**: å¾®ä¿¡åŸºç¡€åº“ 2.21.2+

**ç‰¹æ€§**:
- âœ… é”®ç›˜ä¸Šæ–¹æ˜¾ç¤º"å¾®ä¿¡æ˜µç§°"æç¤º
- âœ… è‡ªåŠ¨è¿›è¡Œå†…å®¹å®‰å…¨æ£€æµ‹
- âœ… æ£€æµ‹è¿è§„å†…å®¹è‡ªåŠ¨æç¤º

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å¤´åƒå¤„ç†

**ä¸´æ—¶è·¯å¾„è¯´æ˜**:
- è·¯å¾„æ ¼å¼ï¼š`wxfile://tmp_xxx.jpg`
- æœ‰æ•ˆæœŸï¼šä¼šè¯æœŸé—´æœ‰æ•ˆ
- é€‚ç”¨åœºæ™¯ï¼šå¿«é€Ÿæ˜¾ç¤ºï¼Œæ— éœ€é•¿æœŸä¿å­˜

**æ¨èå¤„ç†æ–¹å¼**:

```javascript
// æ–¹å¼1ï¼šç›´æ¥ä½¿ç”¨ä¸´æ—¶è·¯å¾„ï¼ˆç®€å•å¿«é€Ÿï¼‰
let avatarUrl = e.detail.avatarUrl

// æ–¹å¼2ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæ¨èï¼Œé•¿æœŸä¿å­˜ï¼‰
const uploadResult = await this.$minApi.uploadAvatar(avatarUrl)
avatarUrl = uploadResult.data.url
```

### 2. æ˜µç§°å®‰å…¨æ£€æµ‹

å¾®ä¿¡ä¼šè‡ªåŠ¨æ£€æµ‹æ˜µç§°å†…å®¹ï¼š
- âœ… è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿè¯
- âœ… é™åˆ¶ç‰¹æ®Šå­—ç¬¦
- âœ… å»ºè®®é•¿åº¦ï¼š2-32ä¸ªå­—ç¬¦

**æœ€ä½³å®è·µ**:
```javascript
// å‰ç«¯éªŒè¯
if (nickname.length < 2 || nickname.length > 32) {
  uni.showToast({ title: 'æ˜µç§°é•¿åº¦ä¸º2-32ä¸ªå­—ç¬¦' })
  return
}

// åç«¯ä¹Ÿåº”è¯¥åšäºŒæ¬¡æ£€æµ‹
```

### 3. å…¼å®¹æ€§æ£€æŸ¥

```javascript
// æ£€æŸ¥æ˜¯å¦æ”¯æŒæ–°èƒ½åŠ›
if (wx.canIUse('button.open-type.chooseAvatar')) {
  // æ”¯æŒæ–°ç‰ˆå¤´åƒé€‰æ‹©
  console.log('æ”¯æŒå¤´åƒé€‰æ‹©')
} else {
  // æç¤ºç”¨æˆ·å‡çº§å¾®ä¿¡
  uni.showModal({
    title: 'æç¤º',
    content: 'è¯·å‡çº§å¾®ä¿¡åˆ°æœ€æ–°ç‰ˆæœ¬ä»¥ä½¿ç”¨å¤´åƒé€‰æ‹©åŠŸèƒ½',
    showCancel: false
  })
}
```

### 4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### åŠ è½½æç¤º
```javascript
uni.showLoading({ title: 'ä¿å­˜å¤´åƒä¸­...' })
uni.showLoading({ title: 'ä¿å­˜ä¸­...' })
uni.hideLoading()
```

#### æˆåŠŸåé¦ˆ
```javascript
uni.showToast({
  title: 'å¤´åƒæ›´æ–°æˆåŠŸ',
  icon: 'success',
  duration: 2000
})
```

#### é”™è¯¯å¤„ç†
```javascript
try {
  await this.saveAvatar(avatarUrl)
} catch (error) {
  uni.showToast({
    title: error.message || 'ä¿å­˜å¤±è´¥',
    icon: 'none',
    duration: 2000
  })
  // æ¢å¤åŸå¤´åƒ
  this.loadUserInfo()
}
```

---

## ğŸ¨ UIè®¾è®¡

### æ˜µç§°ç¼–è¾‘å¼¹çª—å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¼–è¾‘æ˜µç§°            âœ•   â”‚ â† æ ‡é¢˜æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è¯·è¾“å…¥æ˜µç§°           â”‚ â”‚ â† è¾“å…¥æ¡†
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å–æ¶ˆ   â”‚   ä¿å­˜       â”‚ â† æ“ä½œæŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’åŠ¨ç”»

1. **å¼¹çª—æ˜¾ç¤º**ï¼šæ·¡å…¥åŠ¨ç”»
2. **è¾“å…¥èšç„¦**ï¼šé”®ç›˜ä¸Šæ–¹æ˜¾ç¤º"å¾®ä¿¡æ˜µç§°"
3. **ä¿å­˜æˆåŠŸ**ï¼šå¼¹çª—æ·¡å‡ºï¼Œæ˜µç§°æ›´æ–°

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

#### å¤´åƒåŠŸèƒ½
- [x] ç‚¹å‡»å¤´åƒèƒ½å¦è§¦å‘é€‰æ‹©å™¨
- [x] é€‰æ‹©å›¾ç‰‡åèƒ½å¦æ­£ç¡®æ˜¾ç¤º
- [x] å–æ¶ˆé€‰æ‹©æ˜¯å¦ä¸å½±å“ç°æœ‰å¤´åƒ
- [x] ä¸Šä¼ å¤±è´¥æ˜¯å¦æ¢å¤åŸå¤´åƒ
- [x] é¡µé¢åˆ·æ–°åå¤´åƒæ˜¯å¦ä¿æŒ

#### æ˜µç§°åŠŸèƒ½
- [x] ç‚¹å‡»æ˜µç§°èƒ½å¦å¼¹å‡ºå¯¹è¯æ¡†
- [x] è¾“å…¥æ¡†èƒ½å¦æ­£å¸¸è¾“å…¥
- [x] ç‚¹å‡»é®ç½©å±‚èƒ½å¦å…³é—­å¼¹çª—
- [x] ç‚¹å‡»å–æ¶ˆæŒ‰é’®èƒ½å¦å…³é—­å¼¹çª—
- [x] ç‚¹å‡»ä¿å­˜èƒ½å¦æ›´æ–°æ˜µç§°
- [x] ç©ºæ˜µç§°æ˜¯å¦æœ‰æç¤º
- [x] é¡µé¢åˆ·æ–°åæ˜µç§°æ˜¯å¦ä¿æŒ

### è¾¹ç•Œæƒ…å†µæµ‹è¯•

1. **ç½‘ç»œå¼‚å¸¸**
   - [ ] ä¸Šä¼ å¤´åƒæ—¶ç½‘ç»œæ–­å¼€
   - [ ] ä¿å­˜æ˜µç§°æ—¶è¯·æ±‚è¶…æ—¶
   - [ ] Tokenè¿‡æœŸæ—¶çš„å¤„ç†

2. **è¾“å…¥éªŒè¯**
   - [ ] è¾“å…¥ç©ºæ˜µç§°
   - [ ] è¾“å…¥è¶…é•¿æ˜µç§°ï¼ˆ>32å­—ç¬¦ï¼‰
   - [ ] è¾“å…¥ç‰¹æ®Šå­—ç¬¦
   - [ ] è¾“å…¥çº¯ç©ºæ ¼

3. **å¹¶å‘æ“ä½œ**
   - [ ] å¿«é€Ÿè¿ç»­ç‚¹å‡»å¤´åƒ
   - [ ] å¿«é€Ÿè¿ç»­ç‚¹å‡»æ˜µç§°
   - [ ] åŒæ—¶ä¿®æ”¹å¤´åƒå’Œæ˜µç§°

---

## ğŸ“ æ•°æ®æµç¨‹

### å¤´åƒæ›´æ–°æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»å¤´åƒ
   â†“
2. è§¦å‘å¾®ä¿¡å¤´åƒé€‰æ‹©å™¨ (open-type="chooseAvatar")
   â†“
3. é€‰æ‹©å®Œæˆï¼Œè·å–ä¸´æ—¶è·¯å¾„ (avatarUrl)
   â†“
4. æ›´æ–°é¡µé¢æ˜¾ç¤º (this.userImage = avatarUrl)
   â†“
5. è°ƒç”¨åç«¯API (this.$minApi.updateUserProfile)
   â†“
6. æ›´æ–°æœ¬åœ°å­˜å‚¨ (uni.setStorageSync)
   â†“
7. æ˜¾ç¤ºæˆåŠŸæç¤º (uni.showToast)
```

### æ˜µç§°æ›´æ–°æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»æ˜µç§°
   â†“
2. æ˜¾ç¤ºç¼–è¾‘å¼¹çª— (nicknameModalVisible = true)
   â†“
3. ç”¨æˆ·è¾“å…¥æ–°æ˜µç§° (type="nickname" è‡ªåŠ¨æ£€æµ‹)
   â†“
4. ç‚¹å‡»ä¿å­˜æŒ‰é’®
   â†“
5. éªŒè¯è¾“å…¥ (éç©ºæ£€æŸ¥)
   â†“
6. è°ƒç”¨åç«¯API (this.$minApi.updateUserProfile)
   â†“
7. æ›´æ–°æœ¬åœ°å­˜å‚¨ (uni.setStorageSync)
   â†“
8. æ›´æ–°é¡µé¢æ˜¾ç¤º (this.userName = nickname)
   â†“
9. å…³é—­å¼¹çª— (hideNicknameModal)
   â†“
10. æ˜¾ç¤ºæˆåŠŸæç¤º (uni.showToast)
```

---

## ğŸš€ ä¼˜åŒ–å»ºè®®

### å·²å®ç°çš„ä¼˜åŒ–

1. âœ… è‡ªåŠ¨ä¸Šä¼ å¹¶ä¿å­˜
2. âœ… å®æ—¶æ›´æ–°é¡µé¢æ˜¾ç¤º
3. âœ… å®Œå–„çš„åŠ è½½æç¤º
4. âœ… å‹å¥½çš„é”™è¯¯å¤„ç†
5. âœ… æœ¬åœ°å­˜å‚¨åŒæ­¥

### å¯é€‰çš„å¢å¼ºåŠŸèƒ½

1. **å›¾ç‰‡å‹ç¼©**
   ```javascript
   // é€‰æ‹©å¤´åƒåè‡ªåŠ¨å‹ç¼©
   uni.compressImage({
     src: avatarUrl,
     quality: 80,
     success: (res) => {
       this.saveAvatar(res.tempFilePath)
     }
   })
   ```

2. **æ˜µç§°å†å²è®°å½•**
   ```javascript
   // ä¿å­˜æœ€è¿‘ä½¿ç”¨çš„æ˜µç§°
   const nicknameHistory = uni.getStorageSync('nicknameHistory') || []
   nicknameHistory.unshift(nickname)
   uni.setStorageSync('nicknameHistory', nicknameHistory.slice(0, 5))
   ```

3. **é»˜è®¤å¤´åƒåº“**
   ```javascript
   // æä¾›é»˜è®¤å¤´åƒä¾›é€‰æ‹©
   const defaultAvatars = [
     '/static/avatars/avatar1.png',
     '/static/avatars/avatar2.png',
     // ...
   ]
   ```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé€‰æ‹©çš„å¤´åƒè¿‡ä¸€æ®µæ—¶é—´å°±ä¸æ˜¾ç¤ºäº†ï¼Ÿ

**A**: å¾®ä¿¡ä¸´æ—¶è·¯å¾„æœ‰æœ‰æ•ˆæœŸï¼Œå»ºè®®ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š

```javascript
// åœ¨ saveAvatar æ–¹æ³•ä¸­å¯ç”¨ä¸Šä¼ åŠŸèƒ½
const uploadResult = await this.$minApi.uploadAvatar(avatarUrl)
finalAvatarUrl = uploadResult.data.url
```

### Q2: æ˜µç§°è¾“å…¥åè¢«å¾®ä¿¡æ‹¦æˆªæ€ä¹ˆåŠï¼Ÿ

**A**: å¯èƒ½åŒ…å«æ•æ„Ÿè¯ï¼Œå»ºè®®ï¼š
- é¿å…ä½¿ç”¨ç‰¹æ®Šç¬¦å·
- ä¸è¦åŒ…å«æ•æ„Ÿè¯æ±‡
- ä½¿ç”¨ä¸­æ–‡æˆ–è‹±æ–‡å­—ç¬¦

### Q3: å¦‚ä½•è‡ªå®šä¹‰å¼¹çª—æ ·å¼ï¼Ÿ

**A**: ä¿®æ”¹ `.modal-content` ç›¸å…³æ ·å¼ï¼š

```less
.modal-content {
  width: 600rpx;           // ä¿®æ”¹å®½åº¦
  border-radius: 20rpx;    // ä¿®æ”¹åœ†è§’
  background-color: #1E1E1E; // ä¿®æ”¹èƒŒæ™¯è‰²
}
```

### Q4: èƒ½å¦æ·»åŠ å¤´åƒé¢„è§ˆåŠŸèƒ½ï¼Ÿ

**A**: å¯ä»¥æ·»åŠ å›¾ç‰‡é¢„è§ˆï¼š

```javascript
previewAvatar() {
  uni.previewImage({
    urls: [this.userImage],
    current: this.userImage
  })
}
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

ç›¸å…³æ–‡æ¡£ï¼š
- [å¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [UniAppå®˜æ–¹æ–‡æ¡£](https://uniapp.dcloud.net.cn/)
- [åç«¯APIæ–‡æ¡£](../backend/API_TEST.md)

---

## ğŸ“ˆ æ›´æ–°æ—¥å¿—

### v2.0.0 (2024-10-16)

- âœ¨ é‡æ„ä¸ºå½“å‰é¡µé¢ç›´æ¥æ“ä½œï¼Œç§»é™¤è·³è½¬é€»è¾‘
- âœ¨ å¤´åƒç‚¹å‡»ç›´æ¥è§¦å‘å¾®ä¿¡é€‰æ‹©å™¨
- âœ¨ æ˜µç§°ç‚¹å‡»å¼¹å‡ºç¼–è¾‘å¯¹è¯æ¡†
- âœ¨ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œæ“ä½œæ›´æµç•…
- âœ¨ è‡ªåŠ¨ä¸Šä¼ å¹¶ä¿å­˜ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ
- ğŸ”¥ åˆ é™¤ä¸éœ€è¦çš„profile-edité¡µé¢
- ğŸ“ æ›´æ–°å®Œæ•´æ–‡æ¡£

---

**åŠŸèƒ½å®ç°å®Œæˆï¼æ“ä½œæ›´ç®€å•ï¼Œä½“éªŒæ›´æµç•…ï¼ğŸ‰**
